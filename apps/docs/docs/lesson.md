# Уроки

[[toc]]

Уроки используется в [расписании](/docs/event-calendar.html).

Оплаты привязываются к [ученику](/docs/student.html) и служат для составления расписания для ученика.

## Переход в раздел

В меню должен отображаться раздел "Уроки".

При клике на пункт меню "Уроки" происходит переход на страницу с уроками.

## Содержимое десктопной страницы

На странице отображается:
- Заголовок "Уроки"
- Кнопка "Добавить". При клике на кнопку "Добавить" открывается не заполненная форма создания и редактирования урока
- Таблица с уроками

## Таблица оплат

### Десктопная таблица

Таблица платформ содержит колонки:
- "Дата и время"
- "Название урока"
- "Дата и время"
- "Ученик"
- "Оплата"
- "Домашняя работа'
- "Пропуск"
- "Перенос"

Каждая строка таблицы содержит иконку контекстного меню.

При клике на иконку контекстного меню открывается выпадающее меню с пунктами:
- "Посмотреть описание"
- "Редактировать"
- "Удалить"

### Фильтры дестктопной таблицы

Таблица с уроками содержит следующие фильтры:

| Название фильтра        | Тип поиска                          |
|-------------------------|-------------------------------------|
| Поиск по названию урока | Поиск по вхождению в текст / число  |
| Ученики                 | Выбор одного или нескольких пунктов |
| Оплаты                  | Выбор одного или нескольких пунктов |
| Домашняя работа         | Чекбокс                             |
| Пропуск                 | Чекбокс                             |
| Перенос                 | Чекбокс                             |
| Урок                    | Чекбокс                             |

### Содержимое мобильной таблицы

Таблица содержит колонку "Дата и время".

У не раскрытой строки таблица содержит иконку для раскрытия строки.

У раскрытой строки таблица содержит иконку для скрытия строки.

Раскрытая строка содержит пункты:
- "Название урока"
- "Ученик"
- "Оплата"
- "Домашняя работа"
- "Пропуск"
- "Перенос"

### Контекстное меню

Контекстное меню содержит кнопки:
- Посмотреть описание - открывает модальное окно с описанием урока, которое не вошло в таблицу.
- Редактировать - открывает форму редактирования.
- Дублировать - открывает форму создания нового урока с предварительно заполненными данными согласно данным выбранного урока.
- Удалить - открывает модальное окно для удаления выбранного урока.

## Модальное окно "Предупреждение об удалении"

Модальное окно содержит:
- Текст "Вы уверены, что хотите удалить урок?"
- Кнопку "Удалить" и иконку закрытия модального окна

При клике на кнопку "Удалить" урок удаляется и таблица уроков обновляется.

При клике на иконку закрытия происходит закрытие модального окна без удаления урока.

При клике на кнопку "Посмотреть описание" открывается модальное окно с дополнительной информации об уроке.

## Форма {#form-lesson}

### Форма создания и редактирования оплаты

Форма создания и редактирования состоит из полей:

| Название поля                   | Тип поля             | Обязательное поле | Доп описание                                                                                                                                                     |
|---------------------------------|----------------------|-------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Урок по расписанию              | Переключатель        | Нет               | Служит для определения урок будет проходить по расписанию или время урока было изменено. Поле "Ученик" имеет валидацию на максимальное количество символов (100) |
| Урок не подготовлен             | Переключатель        | Нет               | Служит для определения готовности у уроку                                                                                                                        |
| Домашняя работа не подготовлена | Переключатель        | Нет               | Служит для определения готова ли домашняя работа к текущему уроку                                                                                                |
| Урок не пропущен                | Переключатель        | Нет               | Служит для определения был ли текущий урок пропущен                                                                                                              |
| Ученик                          | Список               | Да                | Содержит список учеников для связи с уроком                                                                                                                      |
| Оплата за урок                  | Список               | Нет               | Содержит список оплат доступных для связи с уроком                                                                                                               |
| Название урока                  | Текст                | Да                | Служит для определения идентификации урока                                                                                                                       |
| Время начала                    | Выбор дата и времени | Нет               | Служит для определения времени начала урока                                                                                                                      |
| Время окончания                 | Выбор дата и времени | Да                | Служит для определения времени окончания урока. Поле "Название урока" автоматически заполнено текущей датой + 1 час                                                                                                                 |
| Описание урока                  | Текстовый редактор   | Да                | Поле "Описание урока" имеет валидацию на максимальное количество символов (1000)                                                                                                                                                                 |

В случае создания нового урока форма должна быть пустой.

В случае редактирования урока форма должна быть заполнена данными редактируемого урока.

При создании новой платформ форма содержит кнопку "Создать".

При клике на кнопку "Создать" происходит открытие таблицы "Уроки", которая содержит созданную оплату.

При редактировании урока форма содержит кнопку "Сохранить".

При клике на кнопку "Сохранить" происходит открытие таблицы "Уроки", которая содержит обновленную оплату.

### Особенности работы формы

При установке даты начала дата окончания автоматически обновляется.

В дату окончания устанавливается выбранная дата и время начала плюс один час.

Если сначала установить дату окончания, а потом дату начала, тогда дата окончания все равно обновится согласно логике указанной выше.

#### Доступные оплаты для ученика

В форме создания / редактирования урока в поле "Оплата за урок" загружается список доступных оплат для выбранного ученика.

При изменении выбранного ученика происходит обновление списка доступных оплат. 

Если ученик не выбран, тогда список доступных оплат будет пуст. Если ученик выбран, то список так же может быть пустым в
случае если для выбранного ученика нет подходящих оплат.

#### Что такое доступная оплата

При запросе доступных оплат пользователя сначала выбираются все оплаты, которые привязаны к ученику. Далее происходит фильтрация.

У оплаты берется число из поля "Количество уроков" и из него вычитается число привязанных уроков к оплате. Если в результате мы
получаем число больше нуля, тогда данная оплата считается доступной для выбора при создании или редактирования урока.

#### Кнопка отвязать оплату

Данная кнопка отвязывает урок от выбранной оплаты. При это сама оплата не удаляется.

Изменения вступают в силу после сохранения урока.



