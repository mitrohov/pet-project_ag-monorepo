# Уроки

[[toc]]

Уроки используется в [расписании](/docs/event-calendar.html).
Оплаты привязываются к [ученику](/docs/student.html) и служат для составления расписания для ученика.

## Переход в раздел

В меню должен отображаться раздел "Оплаты".

При клике на пункт меню "Оплаты" происходит переход на страницу с уровнями языка.

## Содержимое страницы

На странице отображается:

- Заголовок "Оплаты"
- Кнопка "Добавить". При клике на кнопку "Добавить" открывается не заполненная форма создания и редактирования оплаты
- Таблица с оплатами

## Создание

Для создания нового урока необходимо кликнуть по кнопке "Добавить" над таблицей.

[Подробнее](/docs/lesson.html#form-lesson)

## Таблица оплат

Таблица платформ содержит колонки:

- "Ученик"
- "Название оплаты"
- "Дата оплаты"
- "Сумма"
- "Оплачено уроков"
- "Осталось уроков"
- "Привязанные уроки"

Каждая строка таблицы содержит иконку контекстного меню.

При клике на иконку контекстного меню открывается выпадающее меню с пунктами: "Редактировать", "Удалить".

При клике на пункт "Редактировать" открывается форма редактирования и создания оплаты.

При клике на пункт "Удалить" открывается модальное окно с подтверждением удаления оплаты.

### Контекстное меню

Контекстное меню содержит кнопки:

- Посмотреть описание - открывает модальное окно с описанием урока
- Редактировать - открывает форму редактирования.
- Дублировать - открывает форму создания нового урока с предварительно заполненными данными согласно данным выбранного урока.
- Удалить - открывает модальное окно для удаления выбранного урока.

### Фильтры таблицы

Таблица с оплатами содержит следующие фильтры:

| Название фильтра                  | Тип поиска                         |
| --------------------------------- | ---------------------------------- |
| Ученики                           | Поиск по вхождению в текст / число |
| Поиск по названиям                | Поиск по вхождению в текст / число |
| Поиск по сумме оплаты             | Поиск по вхождению в текст / число |
| Поиск по кол-ву оплаченных уроков | Поиск по вхождению в текст / число |
| Поиск по кол-ву оставшихся уроков | Поиск по вхождению в текст / число |

## Содержимое мобильной таблицы

Таблица содержит колонку "Дата оплаты"

У не раскрытой строки таблица содержит иконку для раскрытия строки

У раскрытой строки таблица содержит иконку для скрытия строки

Раскрытая строка содержит пункты:

- "Роль"
- "Название оплаты"
- "Ученик"
- "Сумма"
- "Оплачено уроков"
- "Осталось уроков"
- "Привязанные уроки"

## Форма создания и редактирования оплаты

Форма создания и редактирования состоит из полей:

| Название поля     | Тип поля      | Обязательное поле | Доп описание                                                  |
| ----------------- | ------------- | ----------------- | ------------------------------------------------------------- |
| Название оплаты   | Текст         | Да                | Поле имеет валидацию на максимальное количество символов (50) |
| Ученик            | Список        | Да                |                                                               |
| Сумма             | Число         | Да                | Поле имеет валидацию на максимальное указанное число (50000)  |
| Количество уроков | Переключатель | Да                | Поле имеет валидацию на максимальное указанное число (50)     |
| Дата оплаты       | Список        | Да                | Поле автоматически заполнено текущей датой                    |

В случае создания новой оплаты форма должна быть пустой.

В случае редактирования оплаты форма должна быть заполнена данными редактируемой оплаты.

При создании новой платформ форма содержит кнопку "Создать".

При клике на кнопку "Создать" происходит открытие таблицы "Оплаты", которая содержит созданную оплату.

При клике на кнопку "Сохранить" происходит открытие таблицы "Оплаты", которая содержит обновленную оплату.

При редактировании оплаты форма содержит кнопку "Сохранить".

### Особенности работы формы

При установке даты начала дата окончания автоматически обновляется.

В дату окончания устанавливается выбранная дата и время начала плюс один час.

Если сначала установить дату окончания, а потом дату начала, тогда дата окончания все равно обновится согласно логике указанной выше.

#### Доступные оплаты для ученика

В форме создания / редактирования урока в поле "Оплата за урок" загружается список доступных оплат для выбранного ученика.

При изменении выбранного ученика происходит обновление списка доступных оплат.

Если ученик не выбран, тогда список доступных оплат будет пуст.

Если ученик выбран, то список так же может быть пустым в случае если для выбранного ученика нет подходящих оплат.

#### Что такое доступная оплата

При запросе доступных оплат пользователя сначала выбираются все оплаты, которые привязаны к ученику. Далее происходит фильтрация.

У оплаты берется число из поля "Количество уроков" и из него вычитается число привязанных уроков к оплате.

Если в результате мы получаем число больше нуля, тогда данная оплата считается доступной для выбора при создании или редактирования урока.

#### Кнопка отвязать оплату

Данная кнопка отвязывает урок от выбранной оплаты. При это сама оплата не удаляется.

Изменения вступают в силу после сохранения урока.

## Модальное окно "Предупреждение об удалении"

Модальное окно содержит:

- Текст "Вы уверены, что хотите удалить оплату? Удаление оплаты приведет к изменению всех привязанных к оплате событий к статусу 'Без оплаты'!"
- Кнопку "Удалить" и иконку закрытия модального окна

При клике на кнопку "Удалить" платформа удаляется и таблица платформ обновляется.

При клике на иконку закрытия происходит закрытие модального окна без удаления оплаты.
